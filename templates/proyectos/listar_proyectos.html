{% load dict_filters %}
{% if proyectos %}
        {% for proyecto in proyectos %}
        <div class="col">
        {% if forloop.last and proyectos.has_next %}
        <div class="card h-100 shadow-sm" 
          hx-trigger="revealed" 
          hx-get="{{ pagination_url }}?page={{ proyectos.number|add:1 }}" 
          hx-target="#proyectos-grid" 
        <div class="card h-100 shadow-lg border-0 p-2" style="border-radius: 20px;">
        {% else %}
        <div class="card h-100 shadow-sm">
        {% endif %}
          <div class="card-body">
            <h5 class="card-title">{{ proyecto.title }}</h5>
            <p class="card-text">{{ proyecto.description|truncatewords:25 }}</p>
            <p class="card-text"><small class="text-muted">Ubicación: {{ proyecto.location }}</small></p>
            <div style="position:relative;">
              {% if proyecto.image %}
                <img src="{{ proyecto.image.url }}" alt="Imagen del proyecto" class="w-100 mb-3" style="height: 220px; object-fit: cover; border-radius: 18px;">
              {% else %}
                <img src="/static/images/ocean.jpg" alt="Imagen del proyecto" class="w-100 mb-3" style="height: 220px; object-fit: cover; border-radius: 18px;">
              {% endif %}
            </div>
            <div class="card-body p-0">
              <h3 class="fw-bold mb-0">{{ proyecto.title }}</h3>
              <p class="text-secondary mb-3" style="font-size:1.1rem;">{{ proyecto.description }}</p>
              <div class="d-flex flex-wrap gap-4 mb-3">
                <div class="d-flex align-items-center gap-2">
                  <i class="bi bi-calendar-event text-secondary"></i>
                  <span class="fw-semibold">Fecha de Inicio:</span>
                  <span class="fw-bold text-success">{{ proyecto.start_date|date:"d/m/Y" }}</span>
                </div>
                <div class="d-flex align-items-center gap-2">
                  <i class="bi bi-calendar-x text-secondary"></i>
                  <span class="fw-semibold">Fecha de Finalización:</span>
                  <span class="fw-bold text-danger">{{ proyecto.end_date|date:"d/m/Y" }}</span>
                </div>
                <div class="d-flex align-items-center gap-2">
                  <i class="bi bi-geo-alt text-secondary"></i>
                  <span class="fw-semibold">Ubicación:</span>
                  <a href="#" class="fw-bold text-primary text-decoration-none">{{ proyecto.location }}</a>
                </div>
              </div>
              <div class="mb-3">
                <span class="fw-semibold">Estado actual:</span>
                {% if proyecto.status == 'activo' %}
                  <span class="badge bg-success">Activo</span>
                {% else %}
                  <span class="badge bg-secondary">Inactivo</span>
                {% endif %}
              </div>
              {% if user.is_authenticated and user.role == 'organizacion' %}
                <form method="post" action="{% url 'cambiar_estado_proyecto' proyecto.id %}" class="d-inline">
                  {% csrf_token %}
                  {% if proyecto.status == 'activo' %}
                    <button type="submit" name="estado" value="inactivo" class="btn btn-outline-danger btn-sm">Marcar como inactivo</button>
                  {% else %}
                    <button type="submit" name="estado" value="activo" class="btn btn-outline-success btn-sm">Marcar como activo</button>
                  {% endif %}
                </form>
              {% endif %}
              <div class="d-flex gap-2 mt-2">
                <a href="#" class="btn btn-outline-secondary flex-fill">Cancelar</a>
                <a href="{% url 'detalle_proyecto' proyecto.id %}" class="btn btn-primary flex-fill">Ver Detalles</a>
              </div>
            </div>
            {# Modern card already shows actions and details above; removed duplicate summary and buttons #}
          </div>
        </div>
      </div>
        {% endfor %}
{% else %}
<p>No hay proyectos disponibles.</p>
{% endif %}